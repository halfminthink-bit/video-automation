# Phase 7: 動画統合設定

# ========================================
# パフォーマンス設定
# ========================================
performance:
  use_ffmpeg_direct: true       # ffmpeg直接統合を使用（高速化）✅ Phase04/05無効化により有効化
  preset: "faster"              # エンコードプリセット (ultrafast/veryfast/faster/fast/medium)
  parallel_processing: true     # 並列処理有効化
  threads: 0                    # 使用スレッド数（0=自動検出）

# 出力動画設定
output:
  resolution: [1920, 1080]  # 解像度
  fps: 30                   # フレームレート
  codec: "libx264"          # ビデオコーデック
  audio_codec: "aac"        # オーディオコーデック
  preset: "faster"              # エンコード速度 (ultrafast/veryfast/faster/fast/medium) - fasterで品質と速度のバランス
  bitrate: "3000k"          # ビットレート - 3000kで品質と速度のバランス

# 二分割レイアウト設定
split_layout:
  enabled: true             # 二分割レイアウトを有効化
  direction: "vertical"     # レイアウト方向: "horizontal" (左右) or "vertical" (上下)
  ratio: 0.8                # 上部エリアの比率（0.8 = 80%, 下部20%は字幕）

  # 上部（動画側）の設定
  top_side:
    resize_method: "crop"        # crop / fit / stretch
    background_color: "#000000"  # 余白がある場合の背景色

  # 下部（字幕側）の設定
  bottom_side:
    background_color: "#000000"  # 真っ黒
    subtitle_position: "center"  # 中央配置
    subtitle_valign: "center"    # 縦方向も中央
    subtitle_offset_y: -20       # 縦方向のオフセット（負の値で上に移動）- 少し高めに調整
    max_lines: 3                 # 最大3行
    line_spacing: 1.3            # 行間

# クリップループ設定
clip_loop:
  enabled: true             # クリップをループして音声の長さに合わせる
  crossfade_duration: 0.5   # クロスフェード時間（秒）
  min_clip_duration: 4.0    # 最小クリップ長（秒）
  max_clip_duration: 30.0   # 最大クリップ長（秒）

# トランジション設定
transitions:
  default: "crossfade"      # デフォルトのトランジション
  fade_duration: 1.0        # フェード時間（秒）
  crossfade_duration: 1.0   # クロスフェード時間（秒）

# BGM設定
bgm:
  volume: 0.13              # 基本BGM音量（0.0-1.0） - ナレーションの13%
  volume_amplification: 1.0 # 全体の音量増幅率（デフォルト: 1.0 = 増幅なし）
  fade_in: 2.0              # フェードイン時間（秒）
  fade_out: 2.0             # フェードアウト時間（秒）
  crossfade: 3.0            # BGM切り替え時のクロスフェード（秒）
  loop_enabled: true        # BGMループを有効化

  # BGMタイプごとの音量調整（基本音量に対する倍率）
  volume_by_type:
    opening: 1.5   # openingは1.5倍（13% × 1.5 = 19.5%）
    main: 1.0      # mainは1.0倍（13% × 1.0 = 13%）← 下げました
    ending: 0.7    # endingは0.7倍（13% × 0.7 = 9.1%）

# 字幕設定
subtitle:
  font_family: "Noto-Sans-JP-Bold"  # フォント名
  font_size: 60                     # フォントサイズ（ピクセル）
  color: "white"                    # テキスト色
  background_color: "#000000"       # 背景色
  background_opacity: 0.7           # 背景の透明度
  stroke_color: "#000000"           # 縁取り色
  stroke_width: 2                   # 縁取り幅
  position: "bottom"                # 位置（top/center/bottom）
  margin_bottom: 120                # 下からのマージン（ピクセル）- 少し高めに調整
  align: "center"                   # 揃え（left/center/right）
  method: "caption"                 # レンダリング方法

# サムネイル設定
thumbnail:
  timestamp: 5.0            # 抽出する時間（秒）
  resolution: [1280, 720]   # サムネイル解像度
  format: "jpeg"            # フォーマット
  quality: 90               # JPEG品質（0-100）

# メモリ管理
memory:
  max_clips_in_memory: 10   # 同時にメモリに保持する最大クリップ数
  release_clips: true       # 使用済みクリップを解放

# プログレスバー
progress:
  enabled: true             # プログレスバーを表示
  show_eta: true            # 推定残り時間を表示

# 画像タイミング設定
image_timing:
  mode: "llm"      # "equal_split" (均等分割), "keyword_match" (キーワードマッチング), or "llm" (LLM駆動)
  
  # LLM駆動型画像配置設定
  llm:
    model: "claude-3-haiku-20240307"  # 使用するClaudeモデル
    cache_dir: null  # nullの場合は working_dir/07_composition を使用
    min_display_duration: 3.0    # 最小表示時間（秒）
    max_display_duration: 15.0   # 最大表示時間（秒）
    gap_threshold: 2.0           # 隙間埋めの閾値（秒）
  
  # キーワードマッチング設定（フォールバック用）
  keyword_match:
    enabled: true
    min_display_duration: 3.0    # 最小表示時間（秒）
    max_display_duration: 15.0   # 最大表示時間（秒）
    section_boundary_switch: true  # セクション境界で強制切り替え
    
    priority:
      exact_match_weight: 10.0      # 完全一致の重み
      partial_match_weight: 5.0    # 部分一致の重み
      same_section_weight: 3.0     # 同一セクションの重み
      keyword_length_weight: 1.0   # キーワード長の重み