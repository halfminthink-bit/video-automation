# Phase 7: 字幕生成設定

# 字幕の最大行数
max_lines: 2

# 1行あたりの最大文字数（高齢者向け：大きめフォント）
# 2行×18文字 = 最大36文字
max_chars_per_line: 18

# 1つの字幕に含める最大単語数（ElevenLabs タイムスタンプ使用時）
# 2行表示を考慮して増やす
max_words_per_subtitle: 8

# タイミング設定
timing:
  # 最低表示時間（秒）- 音声のタイミングに従う
  min_display_duration: 1.0

  # 最大表示時間（秒）
  max_display_duration: 6.0

  # リードタイム（音声より少し早く表示する時間、秒）
  # 🔥 修正: 文字レベルタイミング使用時は無視されるが、フォールバック用に0.0を設定
  lead_time: 0.0

  # 字幕間のバッファ（秒）- 字幕の切り替わりをスムーズにする
  # 🔥 修正: 文字レベルタイミングは正確なので、ギャップは最小限（0.0）に
  subtitle_gap: 0.0

  # 字幕の重なり防止を有効化（推奨: true）
  prevent_overlap: true

  # 重なり時の優先度
  # "next_subtitle": 次の字幕を優先（重ならないように調整）
  # "min_duration": min_durationを優先（重なっても延長）
  overlap_priority: "next_subtitle"

# 形態素解析設定
morphological_analysis:
  # MeCabを使用するか（より自然な分割）
  # MeCabを使うと、動詞・形容詞の途中で分割されなくなります
  # インストール: pip install python-mecab (Ubuntu: sudo apt install mecab libmecab-dev mecab-ipadic-utf8)
  # WindowsではMeCabのインストールが複雑なため、デフォルトでfalseに設定
  use_mecab: false

  # 文の区切り文字（「。」のみで分割）
  break_on:
    - "。"
    - "！"
    - "？"

# 分割戦略
splitting:
  window_size: 3  # 探索窓のサイズ（理想位置の±3文字）

  # 優先順位とスコア
  priority_scores:
    punctuation: 120       # 句読点（最優先）
    morpheme_boundary: 150 # 形態素境界（MeCab使用時）
    particle: 100          # 助詞の後
    hiragana_to_kanji: 80  # ひらがな→漢字
    kanji_to_hiragana: 60  # 漢字→ひらがな
    katakana_boundary: 40  # カタカナ境界

  # ペナルティ
  penalties:
    distance_from_ideal: 5        # 理想位置から1文字離れるごとに-5
    ends_with_n_tsu: 20           # 「ん」「っ」で終わると-20
    splits_number: 50             # 数字を分割すると-50
    splits_alphabet: 50           # 英字を分割すると-50
    splits_verb_adjective: 500    # 動詞・形容詞の途中で分割すると-500（MeCab使用時）

  # 助詞リスト
  particles:
    - "は"
    - "が"
    - "を"
    - "に"
    - "で"
    - "と"
    - "も"
    - "や"
    - "から"
    - "まで"
    - "より"

  # 行の長さバランス
  balance_lines: true
  min_line_length: 3  # 極端に短い行を避ける

# 句読点は字幕に表示しない（除去する）
remove_punctuation_in_display: true

# ========================================
# 句点での表示延長設定
# ========================================
sentence_end_extension:
  # 句点（。）で終わる字幕の表示延長を有効化
  enabled: true

  # 次の字幕開始の何秒前まで延長可能か（秒）
  # 例: 0.3秒 = 自然な余白を保ちつつ読む時間を確保
  next_start_margin: 0.3

# Whisper設定（音声から正確なタイミング情報を取得）
whisper:
  # Whisperを使用してタイミング情報を取得するか
  enabled: true

  # Whisperモデル名（tiny, base, small, medium, large）
  # tiny: 最も高速だが精度が低い
  # base: バランス型（推奨）
  # small, medium, large: より高精度だが処理時間が長い
  model: "base"

# フォント設定（Phase 8で使用）
font:
  family: "Noto Sans JP Bold"
  size: 60  # ピクセル
  color: "#FFFFFF"  # 白
  background_color: "#000000"  # 黒
  background_opacity: 0.7
  position: "bottom"  # 画面下部
  margin_bottom: 80  # 下からのマージン（px）
  
  # 縁取り設定
  stroke_color: "#000000"
  stroke_width: 2
  
  # シャドウ設定
  shadow_enabled: true
  shadow_offset: [2, 2]
  shadow_color: "#000000"
  shadow_opacity: 0.8

# ========================================
# インパクトレベル別スタイル設定
# ========================================
styles:
  # 通常字幕（インパクトなし）
  none:
    name: "Default"
    font:
      family: "cinecaption226"
      size: 60
      color: "#FFFFFF"          # 白
      stroke_color: "#000000"
      stroke_width: 2
      shadow_enabled: true
      shadow_offset: [2, 2]
      shadow_color: "#000000"
      shadow_opacity: 0.8
    position:
      vertical: "bottom"
      horizontal: "center"
      margin_bottom: 120
      alignment: 2              # ASS: 下部中央揃え
      margin_v: 120
    animations: []

  # 通常の強調（文中のインパクト）
  normal:
    name: "Normal"
    font:
      family: "cinecaption226"
      size: 70
      color: "#FF4444"          # 赤
      stroke_color: "#000000"
      stroke_width: 3
      shadow_enabled: true
      shadow_offset: [3, 3]
      shadow_color: "#000000"
      shadow_opacity: 0.9
    position:
      vertical: "bottom"
      horizontal: "center"
      margin_bottom: 120
      alignment: 2
      margin_v: 120
    animations:
      - type: "fade_in"
        duration_ms: 300
      - type: "scale"
        duration_ms: 400
        scale_from: 105
        scale_to: 100

  # セクションタイトル専用スタイル（最も豪華）
  section_title:
    name: "SectionTitle"
    font:
      family: "cinecaption226"
      size: 100
      color: "#FF0000"          # 赤
      stroke_color: "#000000"
      stroke_width: 4
      shadow_enabled: true
      shadow_offset: [4, 4]
      shadow_color: "#000000"
      shadow_opacity: 0.9
    position:
      vertical: "center"        # 画面中央
      horizontal: "center"
      margin_bottom: 0
      alignment: 5              # ASS: 中央揃え
      margin_v: 0
    animations:
      - type: "fade_in"
        duration_ms: 400
      - type: "zoom_in"
        duration_ms: 500
        scale_from: 110
        scale_to: 100